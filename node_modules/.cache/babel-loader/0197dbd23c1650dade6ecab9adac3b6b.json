{"ast":null,"code":"/**\n * bigtext.js - bigtext element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\nvar fs = require('fs');\n\nvar Node = require('./node');\n\nvar Box = require('./box');\n/**\n * BigText\n */\n\n\nfunction BigText(options) {\n  if (!(this instanceof Node)) {\n    return new BigText(options);\n  }\n\n  options = options || {};\n  options.font = options.font || __dirname + '/../../usr/fonts/ter-u14n.json';\n  options.fontBold = options.font || __dirname + '/../../usr/fonts/ter-u14b.json';\n  this.fch = options.fch;\n  this.ratio = {};\n  this.font = this.loadFont(options.font);\n  this.fontBold = this.loadFont(options.font);\n  Box.call(this, options);\n\n  if (this.style.bold) {\n    this.font = this.fontBold;\n  }\n}\n\nBigText.prototype.__proto__ = Box.prototype;\nBigText.prototype.type = 'bigtext';\n\nBigText.prototype.loadFont = function (filename) {\n  var self = this,\n      data,\n      font;\n  data = JSON.parse(fs.readFileSync(filename, 'utf8'));\n  this.ratio.width = data.width;\n  this.ratio.height = data.height;\n\n  function convertLetter(ch, lines) {\n    var line, i;\n\n    while (lines.length > self.ratio.height) {\n      lines.shift();\n      lines.pop();\n    }\n\n    lines = lines.map(function (line) {\n      var chs = line.split('');\n      chs = chs.map(function (ch) {\n        return ch === ' ' ? 0 : 1;\n      });\n\n      while (chs.length < self.ratio.width) {\n        chs.push(0);\n      }\n\n      return chs;\n    });\n\n    while (lines.length < self.ratio.height) {\n      line = [];\n\n      for (i = 0; i < self.ratio.width; i++) {\n        line.push(0);\n      }\n\n      lines.push(line);\n    }\n\n    return lines;\n  }\n\n  font = Object.keys(data.glyphs).reduce(function (out, ch) {\n    var lines = data.glyphs[ch].map;\n    out[ch] = convertLetter(ch, lines);\n    return out;\n  }, {});\n  delete font[' '];\n  return font;\n};\n\nBigText.prototype.setContent = function (content) {\n  this.content = '';\n  this.text = content || '';\n};\n\nBigText.prototype.render = function () {\n  if (this.position.width == null || this._shrinkWidth) {\n    // if (this.width - this.iwidth < this.ratio.width * this.text.length + 1) {\n    this.position.width = this.ratio.width * this.text.length + 1;\n    this._shrinkWidth = true; // }\n  }\n\n  if (this.position.height == null || this._shrinkHeight) {\n    // if (this.height - this.iheight < this.ratio.height + 0) {\n    this.position.height = this.ratio.height + 0;\n    this._shrinkHeight = true; // }\n  }\n\n  var coords = this._render();\n\n  if (!coords) return;\n  var lines = this.screen.lines,\n      left = coords.xi + this.ileft,\n      top = coords.yi + this.itop,\n      right = coords.xl - this.iright,\n      bottom = coords.yl - this.ibottom;\n  var dattr = this.sattr(this.style),\n      bg = dattr & 0x1ff,\n      fg = dattr >> 9 & 0x1ff,\n      flags = dattr >> 18 & 0x1ff,\n      attr = flags << 18 | bg << 9 | fg;\n\n  for (var x = left, i = 0; x < right; x += this.ratio.width, i++) {\n    var ch = this.text[i];\n    if (!ch) break;\n    var map = this.font[ch];\n    if (!map) continue;\n\n    for (var y = top; y < Math.min(bottom, top + this.ratio.height); y++) {\n      if (!lines[y]) continue;\n      var mline = map[y - top];\n      if (!mline) continue;\n\n      for (var mx = 0; mx < this.ratio.width; mx++) {\n        var mcell = mline[mx];\n        if (mcell == null) break;\n\n        if (this.fch && this.fch !== ' ') {\n          lines[y][x + mx][0] = dattr;\n          lines[y][x + mx][1] = mcell === 1 ? this.fch : this.ch;\n        } else {\n          lines[y][x + mx][0] = mcell === 1 ? attr : dattr;\n          lines[y][x + mx][1] = mcell === 1 ? ' ' : this.ch;\n        }\n      }\n\n      lines[y].dirty = true;\n    }\n  }\n\n  return coords;\n};\n/**\n * Expose\n */\n\n\nmodule.exports = BigText;","map":{"version":3,"sources":["/Users/samianki/node_modules/blessed/lib/widgets/bigtext.js"],"names":["fs","require","Node","Box","BigText","options","font","__dirname","fontBold","fch","ratio","loadFont","call","style","bold","prototype","__proto__","type","filename","self","data","JSON","parse","readFileSync","width","height","convertLetter","ch","lines","line","i","length","shift","pop","map","chs","split","push","Object","keys","glyphs","reduce","out","setContent","content","text","render","position","_shrinkWidth","_shrinkHeight","coords","_render","screen","left","xi","ileft","top","yi","itop","right","xl","iright","bottom","yl","ibottom","dattr","sattr","bg","fg","flags","attr","x","y","Math","min","mline","mx","mcell","dirty","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA,IAAIA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAhB;;AAEA,IAAIC,IAAI,GAAGD,OAAO,CAAC,QAAD,CAAlB;;AACA,IAAIE,GAAG,GAAGF,OAAO,CAAC,OAAD,CAAjB;AAEA;AACA;AACA;;;AAEA,SAASG,OAAT,CAAiBC,OAAjB,EAA0B;AACxB,MAAI,EAAE,gBAAgBH,IAAlB,CAAJ,EAA6B;AAC3B,WAAO,IAAIE,OAAJ,CAAYC,OAAZ,CAAP;AACD;;AACDA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACAA,EAAAA,OAAO,CAACC,IAAR,GAAeD,OAAO,CAACC,IAAR,IACVC,SAAS,GAAG,gCADjB;AAEAF,EAAAA,OAAO,CAACG,QAAR,GAAmBH,OAAO,CAACC,IAAR,IACdC,SAAS,GAAG,gCADjB;AAEA,OAAKE,GAAL,GAAWJ,OAAO,CAACI,GAAnB;AACA,OAAKC,KAAL,GAAa,EAAb;AACA,OAAKJ,IAAL,GAAY,KAAKK,QAAL,CAAcN,OAAO,CAACC,IAAtB,CAAZ;AACA,OAAKE,QAAL,GAAgB,KAAKG,QAAL,CAAcN,OAAO,CAACC,IAAtB,CAAhB;AACAH,EAAAA,GAAG,CAACS,IAAJ,CAAS,IAAT,EAAeP,OAAf;;AACA,MAAI,KAAKQ,KAAL,CAAWC,IAAf,EAAqB;AACnB,SAAKR,IAAL,GAAY,KAAKE,QAAjB;AACD;AACF;;AAEDJ,OAAO,CAACW,SAAR,CAAkBC,SAAlB,GAA8Bb,GAAG,CAACY,SAAlC;AAEAX,OAAO,CAACW,SAAR,CAAkBE,IAAlB,GAAyB,SAAzB;;AAEAb,OAAO,CAACW,SAAR,CAAkBJ,QAAlB,GAA6B,UAASO,QAAT,EAAmB;AAC9C,MAAIC,IAAI,GAAG,IAAX;AAAA,MACIC,IADJ;AAAA,MAEId,IAFJ;AAIAc,EAAAA,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWtB,EAAE,CAACuB,YAAH,CAAgBL,QAAhB,EAA0B,MAA1B,CAAX,CAAP;AAEA,OAAKR,KAAL,CAAWc,KAAX,GAAmBJ,IAAI,CAACI,KAAxB;AACA,OAAKd,KAAL,CAAWe,MAAX,GAAoBL,IAAI,CAACK,MAAzB;;AAEA,WAASC,aAAT,CAAuBC,EAAvB,EAA2BC,KAA3B,EAAkC;AAChC,QAAIC,IAAJ,EAAUC,CAAV;;AAEA,WAAOF,KAAK,CAACG,MAAN,GAAeZ,IAAI,CAACT,KAAL,CAAWe,MAAjC,EAAyC;AACvCG,MAAAA,KAAK,CAACI,KAAN;AACAJ,MAAAA,KAAK,CAACK,GAAN;AACD;;AAEDL,IAAAA,KAAK,GAAGA,KAAK,CAACM,GAAN,CAAU,UAASL,IAAT,EAAe;AAC/B,UAAIM,GAAG,GAAGN,IAAI,CAACO,KAAL,CAAW,EAAX,CAAV;AACAD,MAAAA,GAAG,GAAGA,GAAG,CAACD,GAAJ,CAAQ,UAASP,EAAT,EAAa;AACzB,eAAOA,EAAE,KAAK,GAAP,GAAa,CAAb,GAAiB,CAAxB;AACD,OAFK,CAAN;;AAGA,aAAOQ,GAAG,CAACJ,MAAJ,GAAaZ,IAAI,CAACT,KAAL,CAAWc,KAA/B,EAAsC;AACpCW,QAAAA,GAAG,CAACE,IAAJ,CAAS,CAAT;AACD;;AACD,aAAOF,GAAP;AACD,KATO,CAAR;;AAWA,WAAOP,KAAK,CAACG,MAAN,GAAeZ,IAAI,CAACT,KAAL,CAAWe,MAAjC,EAAyC;AACvCI,MAAAA,IAAI,GAAG,EAAP;;AACA,WAAKC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGX,IAAI,CAACT,KAAL,CAAWc,KAA3B,EAAkCM,CAAC,EAAnC,EAAuC;AACrCD,QAAAA,IAAI,CAACQ,IAAL,CAAU,CAAV;AACD;;AACDT,MAAAA,KAAK,CAACS,IAAN,CAAWR,IAAX;AACD;;AAED,WAAOD,KAAP;AACD;;AAEDtB,EAAAA,IAAI,GAAGgC,MAAM,CAACC,IAAP,CAAYnB,IAAI,CAACoB,MAAjB,EAAyBC,MAAzB,CAAgC,UAASC,GAAT,EAAcf,EAAd,EAAkB;AACvD,QAAIC,KAAK,GAAGR,IAAI,CAACoB,MAAL,CAAYb,EAAZ,EAAgBO,GAA5B;AACAQ,IAAAA,GAAG,CAACf,EAAD,CAAH,GAAUD,aAAa,CAACC,EAAD,EAAKC,KAAL,CAAvB;AACA,WAAOc,GAAP;AACD,GAJM,EAIJ,EAJI,CAAP;AAMA,SAAOpC,IAAI,CAAC,GAAD,CAAX;AAEA,SAAOA,IAAP;AACD,CAjDD;;AAmDAF,OAAO,CAACW,SAAR,CAAkB4B,UAAlB,GAA+B,UAASC,OAAT,EAAkB;AAC/C,OAAKA,OAAL,GAAe,EAAf;AACA,OAAKC,IAAL,GAAYD,OAAO,IAAI,EAAvB;AACD,CAHD;;AAKAxC,OAAO,CAACW,SAAR,CAAkB+B,MAAlB,GAA2B,YAAW;AACpC,MAAI,KAAKC,QAAL,CAAcvB,KAAd,IAAuB,IAAvB,IAA+B,KAAKwB,YAAxC,EAAsD;AACpD;AACE,SAAKD,QAAL,CAAcvB,KAAd,GAAsB,KAAKd,KAAL,CAAWc,KAAX,GAAmB,KAAKqB,IAAL,CAAUd,MAA7B,GAAsC,CAA5D;AACA,SAAKiB,YAAL,GAAoB,IAApB,CAHkD,CAIpD;AACD;;AACD,MAAI,KAAKD,QAAL,CAActB,MAAd,IAAwB,IAAxB,IAAgC,KAAKwB,aAAzC,EAAwD;AACtD;AACE,SAAKF,QAAL,CAActB,MAAd,GAAuB,KAAKf,KAAL,CAAWe,MAAX,GAAoB,CAA3C;AACA,SAAKwB,aAAL,GAAqB,IAArB,CAHoD,CAItD;AACD;;AAED,MAAIC,MAAM,GAAG,KAAKC,OAAL,EAAb;;AACA,MAAI,CAACD,MAAL,EAAa;AAEb,MAAItB,KAAK,GAAG,KAAKwB,MAAL,CAAYxB,KAAxB;AAAA,MACIyB,IAAI,GAAGH,MAAM,CAACI,EAAP,GAAY,KAAKC,KAD5B;AAAA,MAEIC,GAAG,GAAGN,MAAM,CAACO,EAAP,GAAY,KAAKC,IAF3B;AAAA,MAGIC,KAAK,GAAGT,MAAM,CAACU,EAAP,GAAY,KAAKC,MAH7B;AAAA,MAIIC,MAAM,GAAGZ,MAAM,CAACa,EAAP,GAAY,KAAKC,OAJ9B;AAMA,MAAIC,KAAK,GAAG,KAAKC,KAAL,CAAW,KAAKrD,KAAhB,CAAZ;AAAA,MACIsD,EAAE,GAAGF,KAAK,GAAG,KADjB;AAAA,MAEIG,EAAE,GAAIH,KAAK,IAAI,CAAV,GAAe,KAFxB;AAAA,MAGII,KAAK,GAAIJ,KAAK,IAAI,EAAV,GAAgB,KAH5B;AAAA,MAIIK,IAAI,GAAID,KAAK,IAAI,EAAV,GAAiBF,EAAE,IAAI,CAAvB,GAA4BC,EAJvC;;AAMA,OAAK,IAAIG,CAAC,GAAGlB,IAAR,EAAcvB,CAAC,GAAG,CAAvB,EAA0ByC,CAAC,GAAGZ,KAA9B,EAAqCY,CAAC,IAAI,KAAK7D,KAAL,CAAWc,KAAhB,EAAuBM,CAAC,EAA7D,EAAiE;AAC/D,QAAIH,EAAE,GAAG,KAAKkB,IAAL,CAAUf,CAAV,CAAT;AACA,QAAI,CAACH,EAAL,EAAS;AACT,QAAIO,GAAG,GAAG,KAAK5B,IAAL,CAAUqB,EAAV,CAAV;AACA,QAAI,CAACO,GAAL,EAAU;;AACV,SAAK,IAAIsC,CAAC,GAAGhB,GAAb,EAAkBgB,CAAC,GAAGC,IAAI,CAACC,GAAL,CAASZ,MAAT,EAAiBN,GAAG,GAAG,KAAK9C,KAAL,CAAWe,MAAlC,CAAtB,EAAiE+C,CAAC,EAAlE,EAAsE;AACpE,UAAI,CAAC5C,KAAK,CAAC4C,CAAD,CAAV,EAAe;AACf,UAAIG,KAAK,GAAGzC,GAAG,CAACsC,CAAC,GAAGhB,GAAL,CAAf;AACA,UAAI,CAACmB,KAAL,EAAY;;AACZ,WAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG,KAAKlE,KAAL,CAAWc,KAAjC,EAAwCoD,EAAE,EAA1C,EAA8C;AAC5C,YAAIC,KAAK,GAAGF,KAAK,CAACC,EAAD,CAAjB;AACA,YAAIC,KAAK,IAAI,IAAb,EAAmB;;AACnB,YAAI,KAAKpE,GAAL,IAAY,KAAKA,GAAL,KAAa,GAA7B,EAAkC;AAChCmB,UAAAA,KAAK,CAAC4C,CAAD,CAAL,CAASD,CAAC,GAAGK,EAAb,EAAiB,CAAjB,IAAsBX,KAAtB;AACArC,UAAAA,KAAK,CAAC4C,CAAD,CAAL,CAASD,CAAC,GAAGK,EAAb,EAAiB,CAAjB,IAAsBC,KAAK,KAAK,CAAV,GAAc,KAAKpE,GAAnB,GAAyB,KAAKkB,EAApD;AACD,SAHD,MAGO;AACLC,UAAAA,KAAK,CAAC4C,CAAD,CAAL,CAASD,CAAC,GAAGK,EAAb,EAAiB,CAAjB,IAAsBC,KAAK,KAAK,CAAV,GAAcP,IAAd,GAAqBL,KAA3C;AACArC,UAAAA,KAAK,CAAC4C,CAAD,CAAL,CAASD,CAAC,GAAGK,EAAb,EAAiB,CAAjB,IAAsBC,KAAK,KAAK,CAAV,GAAc,GAAd,GAAoB,KAAKlD,EAA/C;AACD;AACF;;AACDC,MAAAA,KAAK,CAAC4C,CAAD,CAAL,CAASM,KAAT,GAAiB,IAAjB;AACD;AACF;;AAED,SAAO5B,MAAP;AACD,CAtDD;AAwDA;AACA;AACA;;;AAEA6B,MAAM,CAACC,OAAP,GAAiB5E,OAAjB","sourcesContent":["/**\n * bigtext.js - bigtext element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\n\nvar fs = require('fs');\n\nvar Node = require('./node');\nvar Box = require('./box');\n\n/**\n * BigText\n */\n\nfunction BigText(options) {\n  if (!(this instanceof Node)) {\n    return new BigText(options);\n  }\n  options = options || {};\n  options.font = options.font\n    || __dirname + '/../../usr/fonts/ter-u14n.json';\n  options.fontBold = options.font\n    || __dirname + '/../../usr/fonts/ter-u14b.json';\n  this.fch = options.fch;\n  this.ratio = {};\n  this.font = this.loadFont(options.font);\n  this.fontBold = this.loadFont(options.font);\n  Box.call(this, options);\n  if (this.style.bold) {\n    this.font = this.fontBold;\n  }\n}\n\nBigText.prototype.__proto__ = Box.prototype;\n\nBigText.prototype.type = 'bigtext';\n\nBigText.prototype.loadFont = function(filename) {\n  var self = this\n    , data\n    , font;\n\n  data = JSON.parse(fs.readFileSync(filename, 'utf8'));\n\n  this.ratio.width = data.width;\n  this.ratio.height = data.height;\n\n  function convertLetter(ch, lines) {\n    var line, i;\n\n    while (lines.length > self.ratio.height) {\n      lines.shift();\n      lines.pop();\n    }\n\n    lines = lines.map(function(line) {\n      var chs = line.split('');\n      chs = chs.map(function(ch) {\n        return ch === ' ' ? 0 : 1;\n      });\n      while (chs.length < self.ratio.width) {\n        chs.push(0);\n      }\n      return chs;\n    });\n\n    while (lines.length < self.ratio.height) {\n      line = [];\n      for (i = 0; i < self.ratio.width; i++) {\n        line.push(0);\n      }\n      lines.push(line);\n    }\n\n    return lines;\n  }\n\n  font = Object.keys(data.glyphs).reduce(function(out, ch) {\n    var lines = data.glyphs[ch].map;\n    out[ch] = convertLetter(ch, lines);\n    return out;\n  }, {});\n\n  delete font[' '];\n\n  return font;\n};\n\nBigText.prototype.setContent = function(content) {\n  this.content = '';\n  this.text = content || '';\n};\n\nBigText.prototype.render = function() {\n  if (this.position.width == null || this._shrinkWidth) {\n    // if (this.width - this.iwidth < this.ratio.width * this.text.length + 1) {\n      this.position.width = this.ratio.width * this.text.length + 1;\n      this._shrinkWidth = true;\n    // }\n  }\n  if (this.position.height == null || this._shrinkHeight) {\n    // if (this.height - this.iheight < this.ratio.height + 0) {\n      this.position.height = this.ratio.height + 0;\n      this._shrinkHeight = true;\n    // }\n  }\n\n  var coords = this._render();\n  if (!coords) return;\n\n  var lines = this.screen.lines\n    , left = coords.xi + this.ileft\n    , top = coords.yi + this.itop\n    , right = coords.xl - this.iright\n    , bottom = coords.yl - this.ibottom;\n\n  var dattr = this.sattr(this.style)\n    , bg = dattr & 0x1ff\n    , fg = (dattr >> 9) & 0x1ff\n    , flags = (dattr >> 18) & 0x1ff\n    , attr = (flags << 18) | (bg << 9) | fg;\n\n  for (var x = left, i = 0; x < right; x += this.ratio.width, i++) {\n    var ch = this.text[i];\n    if (!ch) break;\n    var map = this.font[ch];\n    if (!map) continue;\n    for (var y = top; y < Math.min(bottom, top + this.ratio.height); y++) {\n      if (!lines[y]) continue;\n      var mline = map[y - top];\n      if (!mline) continue;\n      for (var mx = 0; mx < this.ratio.width; mx++) {\n        var mcell = mline[mx];\n        if (mcell == null) break;\n        if (this.fch && this.fch !== ' ') {\n          lines[y][x + mx][0] = dattr;\n          lines[y][x + mx][1] = mcell === 1 ? this.fch : this.ch;\n        } else {\n          lines[y][x + mx][0] = mcell === 1 ? attr : dattr;\n          lines[y][x + mx][1] = mcell === 1 ? ' ' : this.ch;\n        }\n      }\n      lines[y].dirty = true;\n    }\n  }\n\n  return coords;\n};\n\n/**\n * Expose\n */\n\nmodule.exports = BigText;\n"]},"metadata":{},"sourceType":"script"}