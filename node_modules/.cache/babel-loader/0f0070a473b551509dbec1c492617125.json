{"ast":null,"code":"/**\n * list.js - list element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\nvar helpers = require('../helpers');\n\nvar Node = require('./node');\n\nvar Box = require('./box');\n/**\n * List\n */\n\n\nfunction List(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new List(options);\n  }\n\n  options = options || {};\n  options.ignoreKeys = true; // Possibly put this here: this.items = [];\n\n  options.scrollable = true;\n  Box.call(this, options);\n  this.value = '';\n  this.items = [];\n  this.ritems = [];\n  this.selected = 0;\n  this._isList = true;\n\n  if (!this.style.selected) {\n    this.style.selected = {};\n    this.style.selected.bg = options.selectedBg;\n    this.style.selected.fg = options.selectedFg;\n    this.style.selected.bold = options.selectedBold;\n    this.style.selected.underline = options.selectedUnderline;\n    this.style.selected.blink = options.selectedBlink;\n    this.style.selected.inverse = options.selectedInverse;\n    this.style.selected.invisible = options.selectedInvisible;\n  }\n\n  if (!this.style.item) {\n    this.style.item = {};\n    this.style.item.bg = options.itemBg;\n    this.style.item.fg = options.itemFg;\n    this.style.item.bold = options.itemBold;\n    this.style.item.underline = options.itemUnderline;\n    this.style.item.blink = options.itemBlink;\n    this.style.item.inverse = options.itemInverse;\n    this.style.item.invisible = options.itemInvisible;\n  } // Legacy: for apps written before the addition of item attributes.\n\n\n  ['bg', 'fg', 'bold', 'underline', 'blink', 'inverse', 'invisible'].forEach(function (name) {\n    if (self.style[name] != null && self.style.item[name] == null) {\n      self.style.item[name] = self.style[name];\n    }\n  });\n\n  if (this.options.itemHoverBg) {\n    this.options.itemHoverEffects = {\n      bg: this.options.itemHoverBg\n    };\n  }\n\n  if (this.options.itemHoverEffects) {\n    this.style.item.hover = this.options.itemHoverEffects;\n  }\n\n  if (this.options.itemFocusEffects) {\n    this.style.item.focus = this.options.itemFocusEffects;\n  }\n\n  this.interactive = options.interactive !== false;\n  this.mouse = options.mouse || false;\n\n  if (options.items) {\n    this.ritems = options.items;\n    options.items.forEach(this.add.bind(this));\n  }\n\n  this.select(0);\n\n  if (options.mouse) {\n    this.screen._listenMouse(this);\n\n    this.on('element wheeldown', function () {\n      self.select(self.selected + 2);\n      self.screen.render();\n    });\n    this.on('element wheelup', function () {\n      self.select(self.selected - 2);\n      self.screen.render();\n    });\n  }\n\n  if (options.keys) {\n    this.on('keypress', function (ch, key) {\n      if (key.name === 'up' || options.vi && key.name === 'k') {\n        self.up();\n        self.screen.render();\n        return;\n      }\n\n      if (key.name === 'down' || options.vi && key.name === 'j') {\n        self.down();\n        self.screen.render();\n        return;\n      }\n\n      if (key.name === 'enter' || options.vi && key.name === 'l' && !key.shift) {\n        self.enterSelected();\n        return;\n      }\n\n      if (key.name === 'escape' || options.vi && key.name === 'q') {\n        self.cancelSelected();\n        return;\n      }\n\n      if (options.vi && key.name === 'u' && key.ctrl) {\n        self.move(-((self.height - self.iheight) / 2) | 0);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'd' && key.ctrl) {\n        self.move((self.height - self.iheight) / 2 | 0);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'b' && key.ctrl) {\n        self.move(-(self.height - self.iheight));\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'f' && key.ctrl) {\n        self.move(self.height - self.iheight);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'h' && key.shift) {\n        self.move(self.childBase - self.selected);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'm' && key.shift) {\n        // TODO: Maybe use Math.min(this.items.length,\n        // ... for calculating visible items elsewhere.\n        var visible = Math.min(self.height - self.iheight, self.items.length) / 2 | 0;\n        self.move(self.childBase + visible - self.selected);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'l' && key.shift) {\n        // XXX This goes one too far on lists with an odd number of items.\n        self.down(self.childBase + Math.min(self.height - self.iheight, self.items.length) - self.selected);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'g' && !key.shift) {\n        self.select(0);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && key.name === 'g' && key.shift) {\n        self.select(self.items.length - 1);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && (key.ch === '/' || key.ch === '?')) {\n        if (typeof self.options.search !== 'function') {\n          return;\n        }\n\n        return self.options.search(function (err, value) {\n          if (typeof err === 'string' || typeof err === 'function' || typeof err === 'number' || err && err.test) {\n            value = err;\n            err = null;\n          }\n\n          if (err || !value) return self.screen.render();\n          self.select(self.fuzzyFind(value, key.ch === '?'));\n          self.screen.render();\n        });\n      }\n    });\n  }\n\n  this.on('resize', function () {\n    var visible = self.height - self.iheight; // if (self.selected < visible - 1) {\n\n    if (visible >= self.selected + 1) {\n      self.childBase = 0;\n      self.childOffset = self.selected;\n    } else {\n      // Is this supposed to be: self.childBase = visible - self.selected + 1; ?\n      self.childBase = self.selected - visible + 1;\n      self.childOffset = visible - 1;\n    }\n  });\n  this.on('adopt', function (el) {\n    if (!~self.items.indexOf(el)) {\n      el.fixed = true;\n    }\n  }); // Ensure children are removed from the\n  // item list if they are items.\n\n  this.on('remove', function (el) {\n    self.removeItem(el);\n  });\n}\n\nList.prototype.__proto__ = Box.prototype;\nList.prototype.type = 'list';\n\nList.prototype.createItem = function (content) {\n  var self = this; // Note: Could potentially use Button here.\n\n  var options = {\n    screen: this.screen,\n    content: content,\n    align: this.align || 'left',\n    top: 0,\n    left: 0,\n    right: this.scrollbar ? 1 : 0,\n    tags: this.parseTags,\n    height: 1,\n    hoverEffects: this.mouse ? this.style.item.hover : null,\n    focusEffects: this.mouse ? this.style.item.focus : null,\n    autoFocus: false\n  };\n\n  if (!this.screen.autoPadding) {\n    options.top = 1;\n    options.left = this.ileft;\n    options.right = this.iright + (this.scrollbar ? 1 : 0);\n  } // if (this.shrink) {\n  // XXX NOTE: Maybe just do this on all shrinkage once autoPadding is default?\n\n\n  if (this.shrink && this.options.normalShrink) {\n    delete options.right;\n    options.width = 'shrink';\n  }\n\n  ['bg', 'fg', 'bold', 'underline', 'blink', 'inverse', 'invisible'].forEach(function (name) {\n    options[name] = function () {\n      var attr = self.items[self.selected] === item && self.interactive ? self.style.selected[name] : self.style.item[name];\n      if (typeof attr === 'function') attr = attr(item);\n      return attr;\n    };\n  });\n\n  if (this.style.transparent) {\n    options.transparent = true;\n  }\n\n  var item = new Box(options);\n\n  if (this.mouse) {\n    item.on('click', function () {\n      self.focus();\n\n      if (self.items[self.selected] === item) {\n        self.emit('action', item, self.selected);\n        self.emit('select', item, self.selected);\n        return;\n      }\n\n      self.select(item);\n      self.screen.render();\n    });\n  }\n\n  this.emit('create item');\n  return item;\n};\n\nList.prototype.add = List.prototype.addItem = List.prototype.appendItem = function (content) {\n  content = typeof content === 'string' ? content : content.getContent();\n  var item = this.createItem(content);\n  item.position.top = this.items.length;\n\n  if (!this.screen.autoPadding) {\n    item.position.top = this.itop + this.items.length;\n  }\n\n  this.ritems.push(content);\n  this.items.push(item);\n  this.append(item);\n\n  if (this.items.length === 1) {\n    this.select(0);\n  }\n\n  this.emit('add item');\n  return item;\n};\n\nList.prototype.removeItem = function (child) {\n  var i = this.getItemIndex(child);\n\n  if (~i && this.items[i]) {\n    child = this.items.splice(i, 1)[0];\n    this.ritems.splice(i, 1);\n    this.remove(child);\n\n    for (var j = i; j < this.items.length; j++) {\n      this.items[j].position.top--;\n    }\n\n    if (i === this.selected) {\n      this.select(i - 1);\n    }\n  }\n\n  this.emit('remove item');\n  return child;\n};\n\nList.prototype.insertItem = function (child, content) {\n  content = typeof content === 'string' ? content : content.getContent();\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  if (i >= this.items.length) return this.appendItem(content);\n  var item = this.createItem(content);\n\n  for (var j = i; j < this.items.length; j++) {\n    this.items[j].position.top++;\n  }\n\n  item.position.top = i + (!this.screen.autoPadding ? 1 : 0);\n  this.ritems.splice(i, 0, content);\n  this.items.splice(i, 0, item);\n  this.append(item);\n\n  if (i === this.selected) {\n    this.select(i + 1);\n  }\n\n  this.emit('insert item');\n};\n\nList.prototype.getItem = function (child) {\n  return this.items[this.getItemIndex(child)];\n};\n\nList.prototype.setItem = function (child, content) {\n  content = typeof content === 'string' ? content : content.getContent();\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  this.items[i].setContent(content);\n  this.ritems[i] = content;\n};\n\nList.prototype.clearItems = function () {\n  return this.setItems([]);\n};\n\nList.prototype.setItems = function (items) {\n  var original = this.items.slice(),\n      selected = this.selected,\n      sel = this.ritems[this.selected],\n      i = 0;\n  items = items.slice();\n  this.select(0);\n\n  for (; i < items.length; i++) {\n    if (this.items[i]) {\n      this.items[i].setContent(items[i]);\n    } else {\n      this.add(items[i]);\n    }\n  }\n\n  for (; i < original.length; i++) {\n    this.remove(original[i]);\n  }\n\n  this.ritems = items; // Try to find our old item if it still exists.\n\n  sel = items.indexOf(sel);\n\n  if (~sel) {\n    this.select(sel);\n  } else if (items.length === original.length) {\n    this.select(selected);\n  } else {\n    this.select(Math.min(selected, items.length - 1));\n  }\n\n  this.emit('set items');\n};\n\nList.prototype.pushItem = function (content) {\n  this.appendItem(content);\n  return this.items.length;\n};\n\nList.prototype.popItem = function () {\n  return this.removeItem(this.items.length - 1);\n};\n\nList.prototype.unshiftItem = function (content) {\n  this.insertItem(0, content);\n  return this.items.length;\n};\n\nList.prototype.shiftItem = function () {\n  return this.removeItem(0);\n};\n\nList.prototype.spliceItem = function (child, n) {\n  var self = this;\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  var items = Array.prototype.slice.call(arguments, 2);\n  var removed = [];\n\n  while (n--) {\n    removed.push(this.removeItem(i));\n  }\n\n  items.forEach(function (item) {\n    self.insertItem(i++, item);\n  });\n  return removed;\n};\n\nList.prototype.find = List.prototype.fuzzyFind = function (search, back) {\n  var start = this.selected + (back ? -1 : 1),\n      i;\n  if (typeof search === 'number') search += '';\n\n  if (search && search[0] === '/' && search[search.length - 1] === '/') {\n    try {\n      search = new RegExp(search.slice(1, -1));\n    } catch (e) {\n      ;\n    }\n  }\n\n  var test = typeof search === 'string' ? function (item) {\n    return !!~item.indexOf(search);\n  } : search.test ? search.test.bind(search) : search;\n\n  if (typeof test !== 'function') {\n    if (this.screen.options.debug) {\n      throw new Error('fuzzyFind(): `test` is not a function.');\n    }\n\n    return this.selected;\n  }\n\n  if (!back) {\n    for (i = start; i < this.ritems.length; i++) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n\n    for (i = 0; i < start; i++) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n  } else {\n    for (i = start; i >= 0; i--) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n\n    for (i = this.ritems.length - 1; i > start; i--) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n  }\n\n  return this.selected;\n};\n\nList.prototype.getItemIndex = function (child) {\n  if (typeof child === 'number') {\n    return child;\n  } else if (typeof child === 'string') {\n    var i = this.ritems.indexOf(child);\n    if (~i) return i;\n\n    for (i = 0; i < this.ritems.length; i++) {\n      if (helpers.cleanTags(this.ritems[i]) === child) {\n        return i;\n      }\n    }\n\n    return -1;\n  } else {\n    return this.items.indexOf(child);\n  }\n};\n\nList.prototype.select = function (index) {\n  if (!this.interactive) {\n    return;\n  }\n\n  if (!this.items.length) {\n    this.selected = 0;\n    this.value = '';\n    this.scrollTo(0);\n    return;\n  }\n\n  if (typeof index === 'object') {\n    index = this.items.indexOf(index);\n  }\n\n  if (index < 0) {\n    index = 0;\n  } else if (index >= this.items.length) {\n    index = this.items.length - 1;\n  }\n\n  if (this.selected === index && this._listInitialized) return;\n  this._listInitialized = true;\n  this.selected = index;\n  this.value = helpers.cleanTags(this.ritems[this.selected]);\n  if (!this.parent) return;\n  this.scrollTo(this.selected); // XXX Move `action` and `select` events here.\n\n  this.emit('select item', this.items[this.selected], this.selected);\n};\n\nList.prototype.move = function (offset) {\n  this.select(this.selected + offset);\n};\n\nList.prototype.up = function (offset) {\n  this.move(-(offset || 1));\n};\n\nList.prototype.down = function (offset) {\n  this.move(offset || 1);\n};\n\nList.prototype.pick = function (label, callback) {\n  if (!callback) {\n    callback = label;\n    label = null;\n  }\n\n  if (!this.interactive) {\n    return callback();\n  }\n\n  var self = this;\n  var focused = this.screen.focused;\n  if (focused && focused._done) focused._done('stop');\n  this.screen.saveFocus(); // XXX Keep above:\n  // var parent = this.parent;\n  // this.detach();\n  // parent.append(this);\n\n  this.focus();\n  this.show();\n  this.select(0);\n  if (label) this.setLabel(label);\n  this.screen.render();\n  this.once('action', function (el, selected) {\n    if (label) self.removeLabel();\n    self.screen.restoreFocus();\n    self.hide();\n    self.screen.render();\n    if (!el) return callback();\n    return callback(null, helpers.cleanTags(self.ritems[selected]));\n  });\n};\n\nList.prototype.enterSelected = function (i) {\n  if (i != null) this.select(i);\n  this.emit('action', this.items[this.selected], this.selected);\n  this.emit('select', this.items[this.selected], this.selected);\n};\n\nList.prototype.cancelSelected = function (i) {\n  if (i != null) this.select(i);\n  this.emit('action');\n  this.emit('cancel');\n};\n/**\n * Expose\n */\n\n\nmodule.exports = List;","map":{"version":3,"sources":["/Users/samianki/node_modules/blessed/lib/widgets/list.js"],"names":["helpers","require","Node","Box","List","options","self","ignoreKeys","scrollable","call","value","items","ritems","selected","_isList","style","bg","selectedBg","fg","selectedFg","bold","selectedBold","underline","selectedUnderline","blink","selectedBlink","inverse","selectedInverse","invisible","selectedInvisible","item","itemBg","itemFg","itemBold","itemUnderline","itemBlink","itemInverse","itemInvisible","forEach","name","itemHoverBg","itemHoverEffects","hover","itemFocusEffects","focus","interactive","mouse","add","bind","select","screen","_listenMouse","on","render","keys","ch","key","vi","up","down","shift","enterSelected","cancelSelected","ctrl","move","height","iheight","childBase","visible","Math","min","length","search","err","test","fuzzyFind","childOffset","el","indexOf","fixed","removeItem","prototype","__proto__","type","createItem","content","align","top","left","right","scrollbar","tags","parseTags","hoverEffects","focusEffects","autoFocus","autoPadding","ileft","iright","shrink","normalShrink","width","attr","transparent","emit","addItem","appendItem","getContent","position","itop","push","append","child","i","getItemIndex","splice","remove","j","insertItem","getItem","setItem","setContent","clearItems","setItems","original","slice","sel","pushItem","popItem","unshiftItem","shiftItem","spliceItem","n","Array","arguments","removed","find","back","start","RegExp","e","debug","Error","cleanTags","index","scrollTo","_listInitialized","parent","offset","pick","label","callback","focused","_done","saveFocus","show","setLabel","once","removeLabel","restoreFocus","hide","module","exports"],"mappings":"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","sourcesContent":["/**\n * list.js - list element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\n\nvar helpers = require('../helpers');\n\nvar Node = require('./node');\nvar Box = require('./box');\n\n/**\n * List\n */\n\nfunction List(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new List(options);\n  }\n\n  options = options || {};\n\n  options.ignoreKeys = true;\n  // Possibly put this here: this.items = [];\n  options.scrollable = true;\n  Box.call(this, options);\n\n  this.value = '';\n  this.items = [];\n  this.ritems = [];\n  this.selected = 0;\n  this._isList = true;\n\n  if (!this.style.selected) {\n    this.style.selected = {};\n    this.style.selected.bg = options.selectedBg;\n    this.style.selected.fg = options.selectedFg;\n    this.style.selected.bold = options.selectedBold;\n    this.style.selected.underline = options.selectedUnderline;\n    this.style.selected.blink = options.selectedBlink;\n    this.style.selected.inverse = options.selectedInverse;\n    this.style.selected.invisible = options.selectedInvisible;\n  }\n\n  if (!this.style.item) {\n    this.style.item = {};\n    this.style.item.bg = options.itemBg;\n    this.style.item.fg = options.itemFg;\n    this.style.item.bold = options.itemBold;\n    this.style.item.underline = options.itemUnderline;\n    this.style.item.blink = options.itemBlink;\n    this.style.item.inverse = options.itemInverse;\n    this.style.item.invisible = options.itemInvisible;\n  }\n\n  // Legacy: for apps written before the addition of item attributes.\n  ['bg', 'fg', 'bold', 'underline',\n   'blink', 'inverse', 'invisible'].forEach(function(name) {\n    if (self.style[name] != null && self.style.item[name] == null) {\n      self.style.item[name] = self.style[name];\n    }\n  });\n\n  if (this.options.itemHoverBg) {\n    this.options.itemHoverEffects = { bg: this.options.itemHoverBg };\n  }\n\n  if (this.options.itemHoverEffects) {\n    this.style.item.hover = this.options.itemHoverEffects;\n  }\n\n  if (this.options.itemFocusEffects) {\n    this.style.item.focus = this.options.itemFocusEffects;\n  }\n\n  this.interactive = options.interactive !== false;\n\n  this.mouse = options.mouse || false;\n\n  if (options.items) {\n    this.ritems = options.items;\n    options.items.forEach(this.add.bind(this));\n  }\n\n  this.select(0);\n\n  if (options.mouse) {\n    this.screen._listenMouse(this);\n    this.on('element wheeldown', function() {\n      self.select(self.selected + 2);\n      self.screen.render();\n    });\n    this.on('element wheelup', function() {\n      self.select(self.selected - 2);\n      self.screen.render();\n    });\n  }\n\n  if (options.keys) {\n    this.on('keypress', function(ch, key) {\n      if (key.name === 'up' || (options.vi && key.name === 'k')) {\n        self.up();\n        self.screen.render();\n        return;\n      }\n      if (key.name === 'down' || (options.vi && key.name === 'j')) {\n        self.down();\n        self.screen.render();\n        return;\n      }\n      if (key.name === 'enter'\n          || (options.vi && key.name === 'l' && !key.shift)) {\n        self.enterSelected();\n        return;\n      }\n      if (key.name === 'escape' || (options.vi && key.name === 'q')) {\n        self.cancelSelected();\n        return;\n      }\n      if (options.vi && key.name === 'u' && key.ctrl) {\n        self.move(-((self.height - self.iheight) / 2) | 0);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'd' && key.ctrl) {\n        self.move((self.height - self.iheight) / 2 | 0);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'b' && key.ctrl) {\n        self.move(-(self.height - self.iheight));\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'f' && key.ctrl) {\n        self.move(self.height - self.iheight);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'h' && key.shift) {\n        self.move(self.childBase - self.selected);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'm' && key.shift) {\n        // TODO: Maybe use Math.min(this.items.length,\n        // ... for calculating visible items elsewhere.\n        var visible = Math.min(\n          self.height - self.iheight,\n          self.items.length) / 2 | 0;\n        self.move(self.childBase + visible - self.selected);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'l' && key.shift) {\n        // XXX This goes one too far on lists with an odd number of items.\n        self.down(self.childBase\n          + Math.min(self.height - self.iheight, self.items.length)\n          - self.selected);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'g' && !key.shift) {\n        self.select(0);\n        self.screen.render();\n        return;\n      }\n      if (options.vi && key.name === 'g' && key.shift) {\n        self.select(self.items.length - 1);\n        self.screen.render();\n        return;\n      }\n\n      if (options.vi && (key.ch === '/' || key.ch === '?')) {\n        if (typeof self.options.search !== 'function') {\n          return;\n        }\n        return self.options.search(function(err, value) {\n          if (typeof err === 'string' || typeof err === 'function'\n              || typeof err === 'number' || (err && err.test)) {\n            value = err;\n            err = null;\n          }\n          if (err || !value) return self.screen.render();\n          self.select(self.fuzzyFind(value, key.ch === '?'));\n          self.screen.render();\n        });\n      }\n    });\n  }\n\n  this.on('resize', function() {\n    var visible = self.height - self.iheight;\n    // if (self.selected < visible - 1) {\n    if (visible >= self.selected + 1) {\n      self.childBase = 0;\n      self.childOffset = self.selected;\n    } else {\n      // Is this supposed to be: self.childBase = visible - self.selected + 1; ?\n      self.childBase = self.selected - visible + 1;\n      self.childOffset = visible - 1;\n    }\n  });\n\n  this.on('adopt', function(el) {\n    if (!~self.items.indexOf(el)) {\n      el.fixed = true;\n    }\n  });\n\n  // Ensure children are removed from the\n  // item list if they are items.\n  this.on('remove', function(el) {\n    self.removeItem(el);\n  });\n}\n\nList.prototype.__proto__ = Box.prototype;\n\nList.prototype.type = 'list';\n\nList.prototype.createItem = function(content) {\n  var self = this;\n\n  // Note: Could potentially use Button here.\n  var options = {\n    screen: this.screen,\n    content: content,\n    align: this.align || 'left',\n    top: 0,\n    left: 0,\n    right: (this.scrollbar ? 1 : 0),\n    tags: this.parseTags,\n    height: 1,\n    hoverEffects: this.mouse ? this.style.item.hover : null,\n    focusEffects: this.mouse ? this.style.item.focus : null,\n    autoFocus: false\n  };\n\n  if (!this.screen.autoPadding) {\n    options.top = 1;\n    options.left = this.ileft;\n    options.right = this.iright + (this.scrollbar ? 1 : 0);\n  }\n\n  // if (this.shrink) {\n  // XXX NOTE: Maybe just do this on all shrinkage once autoPadding is default?\n  if (this.shrink && this.options.normalShrink) {\n    delete options.right;\n    options.width = 'shrink';\n  }\n\n  ['bg', 'fg', 'bold', 'underline',\n   'blink', 'inverse', 'invisible'].forEach(function(name) {\n    options[name] = function() {\n      var attr = self.items[self.selected] === item && self.interactive\n        ? self.style.selected[name]\n        : self.style.item[name];\n      if (typeof attr === 'function') attr = attr(item);\n      return attr;\n    };\n  });\n\n  if (this.style.transparent) {\n    options.transparent = true;\n  }\n\n  var item = new Box(options);\n\n  if (this.mouse) {\n    item.on('click', function() {\n      self.focus();\n      if (self.items[self.selected] === item) {\n        self.emit('action', item, self.selected);\n        self.emit('select', item, self.selected);\n        return;\n      }\n      self.select(item);\n      self.screen.render();\n    });\n  }\n\n  this.emit('create item');\n\n  return item;\n};\n\nList.prototype.add =\nList.prototype.addItem =\nList.prototype.appendItem = function(content) {\n  content = typeof content === 'string' ? content : content.getContent();\n\n  var item = this.createItem(content);\n  item.position.top = this.items.length;\n  if (!this.screen.autoPadding) {\n    item.position.top = this.itop + this.items.length;\n  }\n\n  this.ritems.push(content);\n  this.items.push(item);\n  this.append(item);\n\n  if (this.items.length === 1) {\n    this.select(0);\n  }\n\n  this.emit('add item');\n\n  return item;\n};\n\nList.prototype.removeItem = function(child) {\n  var i = this.getItemIndex(child);\n  if (~i && this.items[i]) {\n    child = this.items.splice(i, 1)[0];\n    this.ritems.splice(i, 1);\n    this.remove(child);\n    for (var j = i; j < this.items.length; j++) {\n      this.items[j].position.top--;\n    }\n    if (i === this.selected) {\n      this.select(i - 1);\n    }\n  }\n  this.emit('remove item');\n  return child;\n};\n\nList.prototype.insertItem = function(child, content) {\n  content = typeof content === 'string' ? content : content.getContent();\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  if (i >= this.items.length) return this.appendItem(content);\n  var item = this.createItem(content);\n  for (var j = i; j < this.items.length; j++) {\n    this.items[j].position.top++;\n  }\n  item.position.top = i + (!this.screen.autoPadding ? 1 : 0);\n  this.ritems.splice(i, 0, content);\n  this.items.splice(i, 0, item);\n  this.append(item);\n  if (i === this.selected) {\n    this.select(i + 1);\n  }\n  this.emit('insert item');\n};\n\nList.prototype.getItem = function(child) {\n  return this.items[this.getItemIndex(child)];\n};\n\nList.prototype.setItem = function(child, content) {\n  content = typeof content === 'string' ? content : content.getContent();\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  this.items[i].setContent(content);\n  this.ritems[i] = content;\n};\n\nList.prototype.clearItems = function() {\n  return this.setItems([]);\n};\n\nList.prototype.setItems = function(items) {\n  var original = this.items.slice()\n    , selected = this.selected\n    , sel = this.ritems[this.selected]\n    , i = 0;\n\n  items = items.slice();\n\n  this.select(0);\n\n  for (; i < items.length; i++) {\n    if (this.items[i]) {\n      this.items[i].setContent(items[i]);\n    } else {\n      this.add(items[i]);\n    }\n  }\n\n  for (; i < original.length; i++) {\n    this.remove(original[i]);\n  }\n\n  this.ritems = items;\n\n  // Try to find our old item if it still exists.\n  sel = items.indexOf(sel);\n  if (~sel) {\n    this.select(sel);\n  } else if (items.length === original.length) {\n    this.select(selected);\n  } else {\n    this.select(Math.min(selected, items.length - 1));\n  }\n\n  this.emit('set items');\n};\n\nList.prototype.pushItem = function(content) {\n  this.appendItem(content);\n  return this.items.length;\n};\n\nList.prototype.popItem = function() {\n  return this.removeItem(this.items.length - 1);\n};\n\nList.prototype.unshiftItem = function(content) {\n  this.insertItem(0, content);\n  return this.items.length;\n};\n\nList.prototype.shiftItem = function() {\n  return this.removeItem(0);\n};\n\nList.prototype.spliceItem = function(child, n) {\n  var self = this;\n  var i = this.getItemIndex(child);\n  if (!~i) return;\n  var items = Array.prototype.slice.call(arguments, 2);\n  var removed = [];\n  while (n--) {\n    removed.push(this.removeItem(i));\n  }\n  items.forEach(function(item) {\n    self.insertItem(i++, item);\n  });\n  return removed;\n};\n\nList.prototype.find =\nList.prototype.fuzzyFind = function(search, back) {\n  var start = this.selected + (back ? -1 : 1)\n    , i;\n\n  if (typeof search === 'number') search += '';\n\n  if (search && search[0] === '/' && search[search.length - 1] === '/') {\n    try {\n      search = new RegExp(search.slice(1, -1));\n    } catch (e) {\n      ;\n    }\n  }\n\n  var test = typeof search === 'string'\n    ? function(item) { return !!~item.indexOf(search); }\n    : (search.test ? search.test.bind(search) : search);\n\n  if (typeof test !== 'function') {\n    if (this.screen.options.debug) {\n      throw new Error('fuzzyFind(): `test` is not a function.');\n    }\n    return this.selected;\n  }\n\n  if (!back) {\n    for (i = start; i < this.ritems.length; i++) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n    for (i = 0; i < start; i++) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n  } else {\n    for (i = start; i >= 0; i--) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n    for (i = this.ritems.length - 1; i > start; i--) {\n      if (test(helpers.cleanTags(this.ritems[i]))) return i;\n    }\n  }\n\n  return this.selected;\n};\n\nList.prototype.getItemIndex = function(child) {\n  if (typeof child === 'number') {\n    return child;\n  } else if (typeof child === 'string') {\n    var i = this.ritems.indexOf(child);\n    if (~i) return i;\n    for (i = 0; i < this.ritems.length; i++) {\n      if (helpers.cleanTags(this.ritems[i]) === child) {\n        return i;\n      }\n    }\n    return -1;\n  } else {\n    return this.items.indexOf(child);\n  }\n};\n\nList.prototype.select = function(index) {\n  if (!this.interactive) {\n    return;\n  }\n\n  if (!this.items.length) {\n    this.selected = 0;\n    this.value = '';\n    this.scrollTo(0);\n    return;\n  }\n\n  if (typeof index === 'object') {\n    index = this.items.indexOf(index);\n  }\n\n  if (index < 0) {\n    index = 0;\n  } else if (index >= this.items.length) {\n    index = this.items.length - 1;\n  }\n\n  if (this.selected === index && this._listInitialized) return;\n  this._listInitialized = true;\n\n  this.selected = index;\n  this.value = helpers.cleanTags(this.ritems[this.selected]);\n  if (!this.parent) return;\n  this.scrollTo(this.selected);\n\n  // XXX Move `action` and `select` events here.\n  this.emit('select item', this.items[this.selected], this.selected);\n};\n\nList.prototype.move = function(offset) {\n  this.select(this.selected + offset);\n};\n\nList.prototype.up = function(offset) {\n  this.move(-(offset || 1));\n};\n\nList.prototype.down = function(offset) {\n  this.move(offset || 1);\n};\n\nList.prototype.pick = function(label, callback) {\n  if (!callback) {\n    callback = label;\n    label = null;\n  }\n\n  if (!this.interactive) {\n    return callback();\n  }\n\n  var self = this;\n  var focused = this.screen.focused;\n  if (focused && focused._done) focused._done('stop');\n  this.screen.saveFocus();\n\n  // XXX Keep above:\n  // var parent = this.parent;\n  // this.detach();\n  // parent.append(this);\n\n  this.focus();\n  this.show();\n  this.select(0);\n  if (label) this.setLabel(label);\n  this.screen.render();\n  this.once('action', function(el, selected) {\n    if (label) self.removeLabel();\n    self.screen.restoreFocus();\n    self.hide();\n    self.screen.render();\n    if (!el) return callback();\n    return callback(null, helpers.cleanTags(self.ritems[selected]));\n  });\n};\n\nList.prototype.enterSelected = function(i) {\n  if (i != null) this.select(i);\n  this.emit('action', this.items[this.selected], this.selected);\n  this.emit('select', this.items[this.selected], this.selected);\n};\n\nList.prototype.cancelSelected = function(i) {\n  if (i != null) this.select(i);\n  this.emit('action');\n  this.emit('cancel');\n};\n\n/**\n * Expose\n */\n\nmodule.exports = List;\n"]},"metadata":{},"sourceType":"script"}