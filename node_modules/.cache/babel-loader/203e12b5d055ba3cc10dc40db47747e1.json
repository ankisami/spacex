{"ast":null,"code":"/**\n * terminal.js - term.js terminal element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\nvar nextTick = global.setImmediate || process.nextTick.bind(process);\n\nvar Node = require('./node');\n\nvar Box = require('./box');\n/**\n * Terminal\n */\n\n\nfunction Terminal(options) {\n  if (!(this instanceof Node)) {\n    return new Terminal(options);\n  }\n\n  options = options || {};\n  options.scrollable = false;\n  Box.call(this, options); // XXX Workaround for all motion\n\n  if (this.screen.program.tmux && this.screen.program.tmuxVersion >= 2) {\n    this.screen.program.enableMouse();\n  }\n\n  this.handler = options.handler;\n  this.shell = options.shell || process.env.SHELL || 'sh';\n  this.args = options.args || [];\n  this.cursor = this.options.cursor;\n  this.cursorBlink = this.options.cursorBlink;\n  this.screenKeys = this.options.screenKeys;\n  this.style = this.style || {};\n  this.style.bg = this.style.bg || 'default';\n  this.style.fg = this.style.fg || 'default';\n  this.termName = options.terminal || options.term || process.env.TERM || 'xterm';\n  this.bootstrap();\n}\n\nTerminal.prototype.__proto__ = Box.prototype;\nTerminal.prototype.type = 'terminal';\n\nTerminal.prototype.bootstrap = function () {\n  var self = this;\n  var element = {\n    // window\n    get document() {\n      return element;\n    },\n\n    navigator: {\n      userAgent: 'node.js'\n    },\n\n    // document\n    get defaultView() {\n      return element;\n    },\n\n    get documentElement() {\n      return element;\n    },\n\n    createElement: function () {\n      return element;\n    },\n\n    // element\n    get ownerDocument() {\n      return element;\n    },\n\n    addEventListener: function () {},\n    removeEventListener: function () {},\n    getElementsByTagName: function () {\n      return [element];\n    },\n    getElementById: function () {\n      return element;\n    },\n    parentNode: null,\n    offsetParent: null,\n    appendChild: function () {},\n    removeChild: function () {},\n    setAttribute: function () {},\n    getAttribute: function () {},\n    style: {},\n    focus: function () {},\n    blur: function () {},\n    console: console\n  };\n  element.parentNode = element;\n  element.offsetParent = element;\n  this.term = require('term.js')({\n    termName: this.termName,\n    cols: this.width - this.iwidth,\n    rows: this.height - this.iheight,\n    context: element,\n    document: element,\n    body: element,\n    parent: element,\n    cursorBlink: this.cursorBlink,\n    screenKeys: this.screenKeys\n  });\n\n  this.term.refresh = function () {\n    self.screen.render();\n  };\n\n  this.term.keyDown = function () {};\n\n  this.term.keyPress = function () {};\n\n  this.term.open(element); // Emits key sequences in html-land.\n  // Technically not necessary here.\n  // In reality if we wanted to be neat, we would overwrite the keyDown and\n  // keyPress methods with our own node.js-keys->terminal-keys methods, but\n  // since all the keys are already coming in as escape sequences, we can just\n  // send the input directly to the handler/socket (see below).\n  // this.term.on('data', function(data) {\n  //   self.handler(data);\n  // });\n  // Incoming keys and mouse inputs.\n  // NOTE: Cannot pass mouse events - coordinates will be off!\n\n  this.screen.program.input.on('data', this._onData = function (data) {\n    if (self.screen.focused === self && !self._isMouse(data)) {\n      self.handler(data);\n    }\n  });\n  this.onScreenEvent('mouse', function (data) {\n    if (self.screen.focused !== self) return;\n    if (data.x < self.aleft + self.ileft) return;\n    if (data.y < self.atop + self.itop) return;\n    if (data.x > self.aleft - self.ileft + self.width) return;\n    if (data.y > self.atop - self.itop + self.height) return;\n\n    if (self.term.x10Mouse || self.term.vt200Mouse || self.term.normalMouse || self.term.mouseEvents || self.term.utfMouse || self.term.sgrMouse || self.term.urxvtMouse) {\n      ;\n    } else {\n      return;\n    }\n\n    var b = data.raw[0],\n        x = data.x - self.aleft,\n        y = data.y - self.atop,\n        s;\n\n    if (self.term.urxvtMouse) {\n      if (self.screen.program.sgrMouse) {\n        b += 32;\n      }\n\n      s = '\\x1b[' + b + ';' + (x + 32) + ';' + (y + 32) + 'M';\n    } else if (self.term.sgrMouse) {\n      if (!self.screen.program.sgrMouse) {\n        b -= 32;\n      }\n\n      s = '\\x1b[<' + b + ';' + x + ';' + y + (data.action === 'mousedown' ? 'M' : 'm');\n    } else {\n      if (self.screen.program.sgrMouse) {\n        b += 32;\n      }\n\n      s = '\\x1b[M' + String.fromCharCode(b) + String.fromCharCode(x + 32) + String.fromCharCode(y + 32);\n    }\n\n    self.handler(s);\n  });\n  this.on('focus', function () {\n    self.term.focus();\n  });\n  this.on('blur', function () {\n    self.term.blur();\n  });\n  this.term.on('title', function (title) {\n    self.title = title;\n    self.emit('title', title);\n  });\n  this.term.on('passthrough', function (data) {\n    self.screen.program.flush();\n\n    self.screen.program._owrite(data);\n  });\n  this.on('resize', function () {\n    nextTick(function () {\n      self.term.resize(self.width - self.iwidth, self.height - self.iheight);\n    });\n  });\n  this.once('render', function () {\n    self.term.resize(self.width - self.iwidth, self.height - self.iheight);\n  });\n  this.on('destroy', function () {\n    self.kill();\n    self.screen.program.input.removeListener('data', self._onData);\n  });\n\n  if (this.handler) {\n    return;\n  }\n\n  this.pty = require('pty.js').fork(this.shell, this.args, {\n    name: this.termName,\n    cols: this.width - this.iwidth,\n    rows: this.height - this.iheight,\n    cwd: process.env.HOME,\n    env: this.options.env || process.env\n  });\n  this.on('resize', function () {\n    nextTick(function () {\n      try {\n        self.pty.resize(self.width - self.iwidth, self.height - self.iheight);\n      } catch (e) {\n        ;\n      }\n    });\n  });\n\n  this.handler = function (data) {\n    self.pty.write(data);\n    self.screen.render();\n  };\n\n  this.pty.on('data', function (data) {\n    self.write(data);\n    self.screen.render();\n  });\n  this.pty.on('exit', function (code) {\n    self.emit('exit', code || null);\n  });\n  this.onScreenEvent('keypress', function () {\n    self.screen.render();\n  });\n\n  this.screen._listenKeys(this);\n};\n\nTerminal.prototype.write = function (data) {\n  return this.term.write(data);\n};\n\nTerminal.prototype.render = function () {\n  var ret = this._render();\n\n  if (!ret) return;\n  this.dattr = this.sattr(this.style);\n  var xi = ret.xi + this.ileft,\n      xl = ret.xl - this.iright,\n      yi = ret.yi + this.itop,\n      yl = ret.yl - this.ibottom,\n      cursor;\n  var scrollback = this.term.lines.length - (yl - yi);\n\n  for (var y = Math.max(yi, 0); y < yl; y++) {\n    var line = this.screen.lines[y];\n    if (!line || !this.term.lines[scrollback + y - yi]) break;\n\n    if (y === yi + this.term.y && this.term.cursorState && this.screen.focused === this && (this.term.ydisp === this.term.ybase || this.term.selectMode) && !this.term.cursorHidden) {\n      cursor = xi + this.term.x;\n    } else {\n      cursor = -1;\n    }\n\n    for (var x = Math.max(xi, 0); x < xl; x++) {\n      if (!line[x] || !this.term.lines[scrollback + y - yi][x - xi]) break;\n      line[x][0] = this.term.lines[scrollback + y - yi][x - xi][0];\n\n      if (x === cursor) {\n        if (this.cursor === 'line') {\n          line[x][0] = this.dattr;\n          line[x][1] = '\\u2502';\n          continue;\n        } else if (this.cursor === 'underline') {\n          line[x][0] = this.dattr | 2 << 18;\n        } else if (this.cursor === 'block' || !this.cursor) {\n          line[x][0] = this.dattr | 8 << 18;\n        }\n      }\n\n      line[x][1] = this.term.lines[scrollback + y - yi][x - xi][1]; // default foreground = 257\n\n      if ((line[x][0] >> 9 & 0x1ff) === 257) {\n        line[x][0] &= ~(0x1ff << 9);\n        line[x][0] |= (this.dattr >> 9 & 0x1ff) << 9;\n      } // default background = 256\n\n\n      if ((line[x][0] & 0x1ff) === 256) {\n        line[x][0] &= ~0x1ff;\n        line[x][0] |= this.dattr & 0x1ff;\n      }\n    }\n\n    line.dirty = true;\n  }\n\n  return ret;\n};\n\nTerminal.prototype._isMouse = function (buf) {\n  var s = buf;\n\n  if (Buffer.isBuffer(s)) {\n    if (s[0] > 127 && s[1] === undefined) {\n      s[0] -= 128;\n      s = '\\x1b' + s.toString('utf-8');\n    } else {\n      s = s.toString('utf-8');\n    }\n  }\n\n  return buf[0] === 0x1b && buf[1] === 0x5b && buf[2] === 0x4d || /^\\x1b\\[M([\\x00\\u0020-\\uffff]{3})/.test(s) || /^\\x1b\\[(\\d+;\\d+;\\d+)M/.test(s) || /^\\x1b\\[<(\\d+;\\d+;\\d+)([mM])/.test(s) || /^\\x1b\\[<(\\d+;\\d+;\\d+;\\d+)&w/.test(s) || /^\\x1b\\[24([0135])~\\[(\\d+),(\\d+)\\]\\r/.test(s) || /^\\x1b\\[(O|I)/.test(s);\n};\n\nTerminal.prototype.setScroll = Terminal.prototype.scrollTo = function (offset) {\n  this.term.ydisp = offset;\n  return this.emit('scroll');\n};\n\nTerminal.prototype.getScroll = function () {\n  return this.term.ydisp;\n};\n\nTerminal.prototype.scroll = function (offset) {\n  this.term.scrollDisp(offset);\n  return this.emit('scroll');\n};\n\nTerminal.prototype.resetScroll = function () {\n  this.term.ydisp = 0;\n  this.term.ybase = 0;\n  return this.emit('scroll');\n};\n\nTerminal.prototype.getScrollHeight = function () {\n  return this.term.rows - 1;\n};\n\nTerminal.prototype.getScrollPerc = function () {\n  return this.term.ydisp / this.term.ybase * 100;\n};\n\nTerminal.prototype.setScrollPerc = function (i) {\n  return this.setScroll(i / 100 * this.term.ybase | 0);\n};\n\nTerminal.prototype.screenshot = function (xi, xl, yi, yl) {\n  xi = 0 + (xi || 0);\n\n  if (xl != null) {\n    xl = 0 + (xl || 0);\n  } else {\n    xl = this.term.lines[0].length;\n  }\n\n  yi = 0 + (yi || 0);\n\n  if (yl != null) {\n    yl = 0 + (yl || 0);\n  } else {\n    yl = this.term.lines.length;\n  }\n\n  return this.screen.screenshot(xi, xl, yi, yl, this.term);\n};\n\nTerminal.prototype.kill = function () {\n  if (this.pty) {\n    this.pty.destroy();\n    this.pty.kill();\n  }\n\n  this.term.refresh = function () {};\n\n  this.term.write('\\x1b[H\\x1b[J');\n\n  if (this.term._blink) {\n    clearInterval(this.term._blink);\n  }\n\n  this.term.destroy();\n};\n/**\n * Expose\n */\n\n\nmodule.exports = Terminal;","map":{"version":3,"sources":["/Users/samianki/node_modules/blessed/lib/widgets/terminal.js"],"names":["nextTick","global","setImmediate","process","bind","Node","require","Box","Terminal","options","scrollable","call","screen","program","tmux","tmuxVersion","enableMouse","handler","shell","env","SHELL","args","cursor","cursorBlink","screenKeys","style","bg","fg","termName","terminal","term","TERM","bootstrap","prototype","__proto__","type","self","element","document","navigator","userAgent","defaultView","documentElement","createElement","ownerDocument","addEventListener","removeEventListener","getElementsByTagName","getElementById","parentNode","offsetParent","appendChild","removeChild","setAttribute","getAttribute","focus","blur","console","cols","width","iwidth","rows","height","iheight","context","body","parent","refresh","render","keyDown","keyPress","open","input","on","_onData","data","focused","_isMouse","onScreenEvent","x","aleft","ileft","y","atop","itop","x10Mouse","vt200Mouse","normalMouse","mouseEvents","utfMouse","sgrMouse","urxvtMouse","b","raw","s","action","String","fromCharCode","title","emit","flush","_owrite","resize","once","kill","removeListener","pty","fork","name","cwd","HOME","e","write","code","_listenKeys","ret","_render","dattr","sattr","xi","xl","iright","yi","yl","ibottom","scrollback","lines","length","Math","max","line","cursorState","ydisp","ybase","selectMode","cursorHidden","dirty","buf","Buffer","isBuffer","undefined","toString","test","setScroll","scrollTo","offset","getScroll","scroll","scrollDisp","resetScroll","getScrollHeight","getScrollPerc","setScrollPerc","i","screenshot","destroy","_blink","clearInterval","module","exports"],"mappings":"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","sourcesContent":["/**\n * terminal.js - term.js terminal element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\n\nvar nextTick = global.setImmediate || process.nextTick.bind(process);\n\nvar Node = require('./node');\nvar Box = require('./box');\n\n/**\n * Terminal\n */\n\nfunction Terminal(options) {\n  if (!(this instanceof Node)) {\n    return new Terminal(options);\n  }\n\n  options = options || {};\n  options.scrollable = false;\n\n  Box.call(this, options);\n\n  // XXX Workaround for all motion\n  if (this.screen.program.tmux && this.screen.program.tmuxVersion >= 2) {\n    this.screen.program.enableMouse();\n  }\n\n  this.handler = options.handler;\n  this.shell = options.shell || process.env.SHELL || 'sh';\n  this.args = options.args || [];\n\n  this.cursor = this.options.cursor;\n  this.cursorBlink = this.options.cursorBlink;\n  this.screenKeys = this.options.screenKeys;\n\n  this.style = this.style || {};\n  this.style.bg = this.style.bg || 'default';\n  this.style.fg = this.style.fg || 'default';\n\n  this.termName = options.terminal\n    || options.term\n    || process.env.TERM\n    || 'xterm';\n\n  this.bootstrap();\n}\n\nTerminal.prototype.__proto__ = Box.prototype;\n\nTerminal.prototype.type = 'terminal';\n\nTerminal.prototype.bootstrap = function() {\n  var self = this;\n\n  var element = {\n    // window\n    get document() { return element; },\n    navigator: { userAgent: 'node.js' },\n\n    // document\n    get defaultView() { return element; },\n    get documentElement() { return element; },\n    createElement: function() { return element; },\n\n    // element\n    get ownerDocument() { return element; },\n    addEventListener: function() {},\n    removeEventListener: function() {},\n    getElementsByTagName: function() { return [element]; },\n    getElementById: function() { return element; },\n    parentNode: null,\n    offsetParent: null,\n    appendChild: function() {},\n    removeChild: function() {},\n    setAttribute: function() {},\n    getAttribute: function() {},\n    style: {},\n    focus: function() {},\n    blur: function() {},\n    console: console\n  };\n\n  element.parentNode = element;\n  element.offsetParent = element;\n\n  this.term = require('term.js')({\n    termName: this.termName,\n    cols: this.width - this.iwidth,\n    rows: this.height - this.iheight,\n    context: element,\n    document: element,\n    body: element,\n    parent: element,\n    cursorBlink: this.cursorBlink,\n    screenKeys: this.screenKeys\n  });\n\n  this.term.refresh = function() {\n    self.screen.render();\n  };\n\n  this.term.keyDown = function() {};\n  this.term.keyPress = function() {};\n\n  this.term.open(element);\n\n  // Emits key sequences in html-land.\n  // Technically not necessary here.\n  // In reality if we wanted to be neat, we would overwrite the keyDown and\n  // keyPress methods with our own node.js-keys->terminal-keys methods, but\n  // since all the keys are already coming in as escape sequences, we can just\n  // send the input directly to the handler/socket (see below).\n  // this.term.on('data', function(data) {\n  //   self.handler(data);\n  // });\n\n  // Incoming keys and mouse inputs.\n  // NOTE: Cannot pass mouse events - coordinates will be off!\n  this.screen.program.input.on('data', this._onData = function(data) {\n    if (self.screen.focused === self && !self._isMouse(data)) {\n      self.handler(data);\n    }\n  });\n\n  this.onScreenEvent('mouse', function(data) {\n    if (self.screen.focused !== self) return;\n\n    if (data.x < self.aleft + self.ileft) return;\n    if (data.y < self.atop + self.itop) return;\n    if (data.x > self.aleft - self.ileft + self.width) return;\n    if (data.y > self.atop - self.itop + self.height) return;\n\n    if (self.term.x10Mouse\n        || self.term.vt200Mouse\n        || self.term.normalMouse\n        || self.term.mouseEvents\n        || self.term.utfMouse\n        || self.term.sgrMouse\n        || self.term.urxvtMouse) {\n      ;\n    } else {\n      return;\n    }\n\n    var b = data.raw[0]\n      , x = data.x - self.aleft\n      , y = data.y - self.atop\n      , s;\n\n    if (self.term.urxvtMouse) {\n      if (self.screen.program.sgrMouse) {\n        b += 32;\n      }\n      s = '\\x1b[' + b + ';' + (x + 32) + ';' + (y + 32) + 'M';\n    } else if (self.term.sgrMouse) {\n      if (!self.screen.program.sgrMouse) {\n        b -= 32;\n      }\n      s = '\\x1b[<' + b + ';' + x + ';' + y\n        + (data.action === 'mousedown' ? 'M' : 'm');\n    } else {\n      if (self.screen.program.sgrMouse) {\n        b += 32;\n      }\n      s = '\\x1b[M'\n        + String.fromCharCode(b)\n        + String.fromCharCode(x + 32)\n        + String.fromCharCode(y + 32);\n    }\n\n    self.handler(s);\n  });\n\n  this.on('focus', function() {\n    self.term.focus();\n  });\n\n  this.on('blur', function() {\n    self.term.blur();\n  });\n\n  this.term.on('title', function(title) {\n    self.title = title;\n    self.emit('title', title);\n  });\n\n  this.term.on('passthrough', function(data) {\n    self.screen.program.flush();\n    self.screen.program._owrite(data);\n  });\n\n  this.on('resize', function() {\n    nextTick(function() {\n      self.term.resize(self.width - self.iwidth, self.height - self.iheight);\n    });\n  });\n\n  this.once('render', function() {\n    self.term.resize(self.width - self.iwidth, self.height - self.iheight);\n  });\n\n  this.on('destroy', function() {\n    self.kill();\n    self.screen.program.input.removeListener('data', self._onData);\n  });\n\n  if (this.handler) {\n    return;\n  }\n\n  this.pty = require('pty.js').fork(this.shell, this.args, {\n    name: this.termName,\n    cols: this.width - this.iwidth,\n    rows: this.height - this.iheight,\n    cwd: process.env.HOME,\n    env: this.options.env || process.env\n  });\n\n  this.on('resize', function() {\n    nextTick(function() {\n      try {\n        self.pty.resize(self.width - self.iwidth, self.height - self.iheight);\n      } catch (e) {\n        ;\n      }\n    });\n  });\n\n  this.handler = function(data) {\n    self.pty.write(data);\n    self.screen.render();\n  };\n\n  this.pty.on('data', function(data) {\n    self.write(data);\n    self.screen.render();\n  });\n\n  this.pty.on('exit', function(code) {\n    self.emit('exit', code || null);\n  });\n\n  this.onScreenEvent('keypress', function() {\n    self.screen.render();\n  });\n\n  this.screen._listenKeys(this);\n};\n\nTerminal.prototype.write = function(data) {\n  return this.term.write(data);\n};\n\nTerminal.prototype.render = function() {\n  var ret = this._render();\n  if (!ret) return;\n\n  this.dattr = this.sattr(this.style);\n\n  var xi = ret.xi + this.ileft\n    , xl = ret.xl - this.iright\n    , yi = ret.yi + this.itop\n    , yl = ret.yl - this.ibottom\n    , cursor;\n\n  var scrollback = this.term.lines.length - (yl - yi);\n\n  for (var y = Math.max(yi, 0); y < yl; y++) {\n    var line = this.screen.lines[y];\n    if (!line || !this.term.lines[scrollback + y - yi]) break;\n\n    if (y === yi + this.term.y\n        && this.term.cursorState\n        && this.screen.focused === this\n        && (this.term.ydisp === this.term.ybase || this.term.selectMode)\n        && !this.term.cursorHidden) {\n      cursor = xi + this.term.x;\n    } else {\n      cursor = -1;\n    }\n\n    for (var x = Math.max(xi, 0); x < xl; x++) {\n      if (!line[x] || !this.term.lines[scrollback + y - yi][x - xi]) break;\n\n      line[x][0] = this.term.lines[scrollback + y - yi][x - xi][0];\n\n      if (x === cursor) {\n        if (this.cursor === 'line') {\n          line[x][0] = this.dattr;\n          line[x][1] = '\\u2502';\n          continue;\n        } else if (this.cursor === 'underline') {\n          line[x][0] = this.dattr | (2 << 18);\n        } else if (this.cursor === 'block' || !this.cursor) {\n          line[x][0] = this.dattr | (8 << 18);\n        }\n      }\n\n      line[x][1] = this.term.lines[scrollback + y - yi][x - xi][1];\n\n      // default foreground = 257\n      if (((line[x][0] >> 9) & 0x1ff) === 257) {\n        line[x][0] &= ~(0x1ff << 9);\n        line[x][0] |= ((this.dattr >> 9) & 0x1ff) << 9;\n      }\n\n      // default background = 256\n      if ((line[x][0] & 0x1ff) === 256) {\n        line[x][0] &= ~0x1ff;\n        line[x][0] |= this.dattr & 0x1ff;\n      }\n    }\n\n    line.dirty = true;\n  }\n\n  return ret;\n};\n\nTerminal.prototype._isMouse = function(buf) {\n  var s = buf;\n  if (Buffer.isBuffer(s)) {\n    if (s[0] > 127 && s[1] === undefined) {\n      s[0] -= 128;\n      s = '\\x1b' + s.toString('utf-8');\n    } else {\n      s = s.toString('utf-8');\n    }\n  }\n  return (buf[0] === 0x1b && buf[1] === 0x5b && buf[2] === 0x4d)\n    || /^\\x1b\\[M([\\x00\\u0020-\\uffff]{3})/.test(s)\n    || /^\\x1b\\[(\\d+;\\d+;\\d+)M/.test(s)\n    || /^\\x1b\\[<(\\d+;\\d+;\\d+)([mM])/.test(s)\n    || /^\\x1b\\[<(\\d+;\\d+;\\d+;\\d+)&w/.test(s)\n    || /^\\x1b\\[24([0135])~\\[(\\d+),(\\d+)\\]\\r/.test(s)\n    || /^\\x1b\\[(O|I)/.test(s);\n};\n\nTerminal.prototype.setScroll =\nTerminal.prototype.scrollTo = function(offset) {\n  this.term.ydisp = offset;\n  return this.emit('scroll');\n};\n\nTerminal.prototype.getScroll = function() {\n  return this.term.ydisp;\n};\n\nTerminal.prototype.scroll = function(offset) {\n  this.term.scrollDisp(offset);\n  return this.emit('scroll');\n};\n\nTerminal.prototype.resetScroll = function() {\n  this.term.ydisp = 0;\n  this.term.ybase = 0;\n  return this.emit('scroll');\n};\n\nTerminal.prototype.getScrollHeight = function() {\n  return this.term.rows - 1;\n};\n\nTerminal.prototype.getScrollPerc = function() {\n  return (this.term.ydisp / this.term.ybase) * 100;\n};\n\nTerminal.prototype.setScrollPerc = function(i) {\n  return this.setScroll((i / 100) * this.term.ybase | 0);\n};\n\nTerminal.prototype.screenshot = function(xi, xl, yi, yl) {\n  xi = 0 + (xi || 0);\n  if (xl != null) {\n    xl = 0 + (xl || 0);\n  } else {\n    xl = this.term.lines[0].length;\n  }\n  yi = 0 + (yi || 0);\n  if (yl != null) {\n    yl = 0 + (yl || 0);\n  } else {\n    yl = this.term.lines.length;\n  }\n  return this.screen.screenshot(xi, xl, yi, yl, this.term);\n};\n\nTerminal.prototype.kill = function() {\n  if (this.pty) {\n    this.pty.destroy();\n    this.pty.kill();\n  }\n  this.term.refresh = function() {};\n  this.term.write('\\x1b[H\\x1b[J');\n  if (this.term._blink) {\n    clearInterval(this.term._blink);\n  }\n  this.term.destroy();\n};\n\n/**\n * Expose\n */\n\nmodule.exports = Terminal;\n"]},"metadata":{},"sourceType":"script"}