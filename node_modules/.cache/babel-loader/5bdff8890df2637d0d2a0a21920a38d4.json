{"ast":null,"code":"/**\n * filemanager.js - file manager element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\nvar path = require('path'),\n    fs = require('fs');\n\nvar helpers = require('../helpers');\n\nvar Node = require('./node');\n\nvar List = require('./list');\n/**\n * FileManager\n */\n\n\nfunction FileManager(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new FileManager(options);\n  }\n\n  options = options || {};\n  options.parseTags = true; // options.label = ' {blue-fg}%path{/blue-fg} ';\n\n  List.call(this, options);\n  this.cwd = options.cwd || process.cwd();\n  this.file = this.cwd;\n  this.value = this.cwd;\n\n  if (options.label && ~options.label.indexOf('%path')) {\n    this._label.setContent(options.label.replace('%path', this.cwd));\n  }\n\n  this.on('select', function (item) {\n    var value = item.content.replace(/\\{[^{}]+\\}/g, '').replace(/@$/, ''),\n        file = path.resolve(self.cwd, value);\n    return fs.stat(file, function (err, stat) {\n      if (err) {\n        return self.emit('error', err, file);\n      }\n\n      self.file = file;\n      self.value = file;\n\n      if (stat.isDirectory()) {\n        self.emit('cd', file, self.cwd);\n        self.cwd = file;\n\n        if (options.label && ~options.label.indexOf('%path')) {\n          self._label.setContent(options.label.replace('%path', file));\n        }\n\n        self.refresh();\n      } else {\n        self.emit('file', file);\n      }\n    });\n  });\n}\n\nFileManager.prototype.__proto__ = List.prototype;\nFileManager.prototype.type = 'file-manager';\n\nFileManager.prototype.refresh = function (cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n\n  var self = this;\n  if (cwd) this.cwd = cwd;else cwd = this.cwd;\n  return fs.readdir(cwd, function (err, list) {\n    if (err && err.code === 'ENOENT') {\n      self.cwd = cwd !== process.env.HOME ? process.env.HOME : '/';\n      return self.refresh(callback);\n    }\n\n    if (err) {\n      if (callback) return callback(err);\n      return self.emit('error', err, cwd);\n    }\n\n    var dirs = [],\n        files = [];\n    list.unshift('..');\n    list.forEach(function (name) {\n      var f = path.resolve(cwd, name),\n          stat;\n\n      try {\n        stat = fs.lstatSync(f);\n      } catch (e) {\n        ;\n      }\n\n      if (stat && stat.isDirectory() || name === '..') {\n        dirs.push({\n          name: name,\n          text: '{light-blue-fg}' + name + '{/light-blue-fg}/',\n          dir: true\n        });\n      } else if (stat && stat.isSymbolicLink()) {\n        files.push({\n          name: name,\n          text: '{light-cyan-fg}' + name + '{/light-cyan-fg}@',\n          dir: false\n        });\n      } else {\n        files.push({\n          name: name,\n          text: name,\n          dir: false\n        });\n      }\n    });\n    dirs = helpers.asort(dirs);\n    files = helpers.asort(files);\n    list = dirs.concat(files).map(function (data) {\n      return data.text;\n    });\n    self.setItems(list);\n    self.select(0);\n    self.screen.render();\n    self.emit('refresh');\n    if (callback) callback();\n  });\n};\n\nFileManager.prototype.pick = function (cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n\n  var self = this,\n      focused = this.screen.focused === this,\n      hidden = this.hidden,\n      onfile,\n      oncancel;\n\n  function resume() {\n    self.removeListener('file', onfile);\n    self.removeListener('cancel', oncancel);\n\n    if (hidden) {\n      self.hide();\n    }\n\n    if (!focused) {\n      self.screen.restoreFocus();\n    }\n\n    self.screen.render();\n  }\n\n  this.on('file', onfile = function (file) {\n    resume();\n    return callback(null, file);\n  });\n  this.on('cancel', oncancel = function () {\n    resume();\n    return callback();\n  });\n  this.refresh(cwd, function (err) {\n    if (err) return callback(err);\n\n    if (hidden) {\n      self.show();\n    }\n\n    if (!focused) {\n      self.screen.saveFocus();\n      self.focus();\n    }\n\n    self.screen.render();\n  });\n};\n\nFileManager.prototype.reset = function (cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n\n  this.cwd = cwd || this.options.cwd;\n  this.refresh(callback);\n};\n/**\n * Expose\n */\n\n\nmodule.exports = FileManager;","map":{"version":3,"sources":["/Users/samianki/node_modules/blessed/lib/widgets/filemanager.js"],"names":["path","require","fs","helpers","Node","List","FileManager","options","self","parseTags","call","cwd","process","file","value","label","indexOf","_label","setContent","replace","on","item","content","resolve","stat","err","emit","isDirectory","refresh","prototype","__proto__","type","callback","readdir","list","code","env","HOME","dirs","files","unshift","forEach","name","f","lstatSync","e","push","text","dir","isSymbolicLink","asort","concat","map","data","setItems","select","screen","render","pick","focused","hidden","onfile","oncancel","resume","removeListener","hide","restoreFocus","show","saveFocus","focus","reset","module","exports"],"mappings":"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","sourcesContent":["/**\n * filemanager.js - file manager element for blessed\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\n\nvar path = require('path')\n  , fs = require('fs');\n\nvar helpers = require('../helpers');\n\nvar Node = require('./node');\nvar List = require('./list');\n\n/**\n * FileManager\n */\n\nfunction FileManager(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new FileManager(options);\n  }\n\n  options = options || {};\n  options.parseTags = true;\n  // options.label = ' {blue-fg}%path{/blue-fg} ';\n\n  List.call(this, options);\n\n  this.cwd = options.cwd || process.cwd();\n  this.file = this.cwd;\n  this.value = this.cwd;\n\n  if (options.label && ~options.label.indexOf('%path')) {\n    this._label.setContent(options.label.replace('%path', this.cwd));\n  }\n\n  this.on('select', function(item) {\n    var value = item.content.replace(/\\{[^{}]+\\}/g, '').replace(/@$/, '')\n      , file = path.resolve(self.cwd, value);\n\n    return fs.stat(file, function(err, stat) {\n      if (err) {\n        return self.emit('error', err, file);\n      }\n      self.file = file;\n      self.value = file;\n      if (stat.isDirectory()) {\n        self.emit('cd', file, self.cwd);\n        self.cwd = file;\n        if (options.label && ~options.label.indexOf('%path')) {\n          self._label.setContent(options.label.replace('%path', file));\n        }\n        self.refresh();\n      } else {\n        self.emit('file', file);\n      }\n    });\n  });\n}\n\nFileManager.prototype.__proto__ = List.prototype;\n\nFileManager.prototype.type = 'file-manager';\n\nFileManager.prototype.refresh = function(cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n\n  var self = this;\n\n  if (cwd) this.cwd = cwd;\n  else cwd = this.cwd;\n\n  return fs.readdir(cwd, function(err, list) {\n    if (err && err.code === 'ENOENT') {\n      self.cwd = cwd !== process.env.HOME\n        ? process.env.HOME\n        : '/';\n      return self.refresh(callback);\n    }\n\n    if (err) {\n      if (callback) return callback(err);\n      return self.emit('error', err, cwd);\n    }\n\n    var dirs = []\n      , files = [];\n\n    list.unshift('..');\n\n    list.forEach(function(name) {\n      var f = path.resolve(cwd, name)\n        , stat;\n\n      try {\n        stat = fs.lstatSync(f);\n      } catch (e) {\n        ;\n      }\n\n      if ((stat && stat.isDirectory()) || name === '..') {\n        dirs.push({\n          name: name,\n          text: '{light-blue-fg}' + name + '{/light-blue-fg}/',\n          dir: true\n        });\n      } else if (stat && stat.isSymbolicLink()) {\n        files.push({\n          name: name,\n          text: '{light-cyan-fg}' + name + '{/light-cyan-fg}@',\n          dir: false\n        });\n      } else {\n        files.push({\n          name: name,\n          text: name,\n          dir: false\n        });\n      }\n    });\n\n    dirs = helpers.asort(dirs);\n    files = helpers.asort(files);\n\n    list = dirs.concat(files).map(function(data) {\n      return data.text;\n    });\n\n    self.setItems(list);\n    self.select(0);\n    self.screen.render();\n\n    self.emit('refresh');\n\n    if (callback) callback();\n  });\n};\n\nFileManager.prototype.pick = function(cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n\n  var self = this\n    , focused = this.screen.focused === this\n    , hidden = this.hidden\n    , onfile\n    , oncancel;\n\n  function resume() {\n    self.removeListener('file', onfile);\n    self.removeListener('cancel', oncancel);\n    if (hidden) {\n      self.hide();\n    }\n    if (!focused) {\n      self.screen.restoreFocus();\n    }\n    self.screen.render();\n  }\n\n  this.on('file', onfile = function(file) {\n    resume();\n    return callback(null, file);\n  });\n\n  this.on('cancel', oncancel = function() {\n    resume();\n    return callback();\n  });\n\n  this.refresh(cwd, function(err) {\n    if (err) return callback(err);\n\n    if (hidden) {\n      self.show();\n    }\n\n    if (!focused) {\n      self.screen.saveFocus();\n      self.focus();\n    }\n\n    self.screen.render();\n  });\n};\n\nFileManager.prototype.reset = function(cwd, callback) {\n  if (!callback) {\n    callback = cwd;\n    cwd = null;\n  }\n  this.cwd = cwd || this.options.cwd;\n  this.refresh(callback);\n};\n\n/**\n * Expose\n */\n\nmodule.exports = FileManager;\n"]},"metadata":{},"sourceType":"script"}