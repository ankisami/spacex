{"ast":null,"code":"/**\n * ansiimage.js - render PNGS/GIFS as ANSI\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\nvar cp = require('child_process');\n\nvar colors = require('../colors');\n\nvar Node = require('./node');\n\nvar Box = require('./box');\n\nvar tng = require('../../vendor/tng');\n/**\n * ANSIImage\n */\n\n\nfunction ANSIImage(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new ANSIImage(options);\n  }\n\n  options = options || {};\n  options.shrink = true;\n  Box.call(this, options);\n  this.scale = this.options.scale || 1.0;\n  this.options.animate = this.options.animate !== false;\n  this._noFill = true;\n\n  if (this.options.file) {\n    this.setImage(this.options.file);\n  }\n\n  this.screen.on('prerender', function () {\n    var lpos = self.lpos;\n    if (!lpos) return; // prevent image from blending with itself if there are alpha channels\n\n    self.screen.clearRegion(lpos.xi, lpos.xl, lpos.yi, lpos.yl);\n  });\n  this.on('destroy', function () {\n    self.stop();\n  });\n}\n\nANSIImage.prototype.__proto__ = Box.prototype;\nANSIImage.prototype.type = 'ansiimage';\n\nANSIImage.curl = function (url) {\n  try {\n    return cp.execFileSync('curl', ['-s', '-A', '', url], {\n      stdio: ['ignore', 'pipe', 'ignore']\n    });\n  } catch (e) {\n    ;\n  }\n\n  try {\n    return cp.execFileSync('wget', ['-U', '', '-O', '-', url], {\n      stdio: ['ignore', 'pipe', 'ignore']\n    });\n  } catch (e) {\n    ;\n  }\n\n  throw new Error('curl or wget failed.');\n};\n\nANSIImage.prototype.setImage = function (file) {\n  this.file = typeof file === 'string' ? file : null;\n\n  if (/^https?:/.test(file)) {\n    file = ANSIImage.curl(file);\n  }\n\n  var width = this.position.width;\n  var height = this.position.height;\n\n  if (width != null) {\n    width = this.width;\n  }\n\n  if (height != null) {\n    height = this.height;\n  }\n\n  try {\n    this.setContent('');\n    this.img = tng(file, {\n      colors: colors,\n      width: width,\n      height: height,\n      scale: this.scale,\n      ascii: this.options.ascii,\n      speed: this.options.speed,\n      filename: this.file\n    });\n\n    if (width == null || height == null) {\n      this.width = this.img.cellmap[0].length;\n      this.height = this.img.cellmap.length;\n    }\n\n    if (this.img.frames && this.options.animate) {\n      this.play();\n    } else {\n      this.cellmap = this.img.cellmap;\n    }\n  } catch (e) {\n    this.setContent('Image Error: ' + e.message);\n    this.img = null;\n    this.cellmap = null;\n  }\n};\n\nANSIImage.prototype.play = function () {\n  var self = this;\n  if (!this.img) return;\n  return this.img.play(function (bmp, cellmap) {\n    self.cellmap = cellmap;\n    self.screen.render();\n  });\n};\n\nANSIImage.prototype.pause = function () {\n  if (!this.img) return;\n  return this.img.pause();\n};\n\nANSIImage.prototype.stop = function () {\n  if (!this.img) return;\n  return this.img.stop();\n};\n\nANSIImage.prototype.clearImage = function () {\n  this.stop();\n  this.setContent('');\n  this.img = null;\n  this.cellmap = null;\n};\n\nANSIImage.prototype.render = function () {\n  var coords = this._render();\n\n  if (!coords) return;\n\n  if (this.img && this.cellmap) {\n    this.img.renderElement(this.cellmap, this);\n  }\n\n  return coords;\n};\n/**\n * Expose\n */\n\n\nmodule.exports = ANSIImage;","map":{"version":3,"sources":["/Users/samianki/node_modules/blessed/lib/widgets/ansiimage.js"],"names":["cp","require","colors","Node","Box","tng","ANSIImage","options","self","shrink","call","scale","animate","_noFill","file","setImage","screen","on","lpos","clearRegion","xi","xl","yi","yl","stop","prototype","__proto__","type","curl","url","execFileSync","stdio","e","Error","test","width","position","height","setContent","img","ascii","speed","filename","cellmap","length","frames","play","message","bmp","render","pause","clearImage","coords","_render","renderElement","module","exports"],"mappings":"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","sourcesContent":["/**\n * ansiimage.js - render PNGS/GIFS as ANSI\n * Copyright (c) 2013-2015, Christopher Jeffrey and contributors (MIT License).\n * https://github.com/chjj/blessed\n */\n\n/**\n * Modules\n */\n\nvar cp = require('child_process');\n\nvar colors = require('../colors');\n\nvar Node = require('./node');\nvar Box = require('./box');\n\nvar tng = require('../../vendor/tng');\n\n/**\n * ANSIImage\n */\n\nfunction ANSIImage(options) {\n  var self = this;\n\n  if (!(this instanceof Node)) {\n    return new ANSIImage(options);\n  }\n\n  options = options || {};\n  options.shrink = true;\n\n  Box.call(this, options);\n\n  this.scale = this.options.scale || 1.0;\n  this.options.animate = this.options.animate !== false;\n  this._noFill = true;\n\n  if (this.options.file) {\n    this.setImage(this.options.file);\n  }\n\n  this.screen.on('prerender', function() {\n    var lpos = self.lpos;\n    if (!lpos) return;\n    // prevent image from blending with itself if there are alpha channels\n    self.screen.clearRegion(lpos.xi, lpos.xl, lpos.yi, lpos.yl);\n  });\n\n  this.on('destroy', function() {\n    self.stop();\n  });\n}\n\nANSIImage.prototype.__proto__ = Box.prototype;\n\nANSIImage.prototype.type = 'ansiimage';\n\nANSIImage.curl = function(url) {\n  try {\n    return cp.execFileSync('curl',\n      ['-s', '-A', '', url],\n      { stdio: ['ignore', 'pipe', 'ignore'] });\n  } catch (e) {\n    ;\n  }\n  try {\n    return cp.execFileSync('wget',\n      ['-U', '', '-O', '-', url],\n      { stdio: ['ignore', 'pipe', 'ignore'] });\n  } catch (e) {\n    ;\n  }\n  throw new Error('curl or wget failed.');\n};\n\nANSIImage.prototype.setImage = function(file) {\n  this.file = typeof file === 'string' ? file : null;\n\n  if (/^https?:/.test(file)) {\n    file = ANSIImage.curl(file);\n  }\n\n  var width = this.position.width;\n  var height = this.position.height;\n\n  if (width != null) {\n    width = this.width;\n  }\n\n  if (height != null) {\n    height = this.height;\n  }\n\n  try {\n    this.setContent('');\n\n    this.img = tng(file, {\n      colors: colors,\n      width: width,\n      height: height,\n      scale: this.scale,\n      ascii: this.options.ascii,\n      speed: this.options.speed,\n      filename: this.file\n    });\n\n    if (width == null || height == null) {\n      this.width = this.img.cellmap[0].length;\n      this.height = this.img.cellmap.length;\n    }\n\n    if (this.img.frames && this.options.animate) {\n      this.play();\n    } else {\n      this.cellmap = this.img.cellmap;\n    }\n  } catch (e) {\n    this.setContent('Image Error: ' + e.message);\n    this.img = null;\n    this.cellmap = null;\n  }\n};\n\nANSIImage.prototype.play = function() {\n  var self = this;\n  if (!this.img) return;\n  return this.img.play(function(bmp, cellmap) {\n    self.cellmap = cellmap;\n    self.screen.render();\n  });\n};\n\nANSIImage.prototype.pause = function() {\n  if (!this.img) return;\n  return this.img.pause();\n};\n\nANSIImage.prototype.stop = function() {\n  if (!this.img) return;\n  return this.img.stop();\n};\n\nANSIImage.prototype.clearImage = function() {\n  this.stop();\n  this.setContent('');\n  this.img = null;\n  this.cellmap = null;\n};\n\nANSIImage.prototype.render = function() {\n  var coords = this._render();\n  if (!coords) return;\n\n  if (this.img && this.cellmap) {\n    this.img.renderElement(this.cellmap, this);\n  }\n\n  return coords;\n};\n\n/**\n * Expose\n */\n\nmodule.exports = ANSIImage;\n"]},"metadata":{},"sourceType":"script"}